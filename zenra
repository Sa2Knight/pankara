#bin/bash
APPDIR="/home/vagrant/March"
cd $APPDIR
command="$1"
subcommand="$2"

if [ "$command" = "run" ]; then
	bundle exec unicorn --port 8080
elif [ "$command" = "mysql" ]; then
	mysql -u root --password=zenra march
elif [ "$command" = "init_db" ]; then
	mysql -u root --password=zenra -e "source bin/init.sql"
	if [ "$subcommand" = "--withrandom" ]; then
		ruby bin/insert_random_rows.rb > bin/tmp.sql
		mysql -u root --password=zenra -e "source bin/tmp.sql"
		rm bin/tmp.sql
	elif [ "$subcommand" = "--withfixed" ]; then
		ruby bin/insert_fixed_rows.rb > bin/tmp.sql
		mysql -u root --password=zenra -e "source bin/tmp.sql"
		rm bin/tmp.sql
	elif [ "$subcommand" = "--withreal" ]; then
		mysql -u root --password=zenra -e "source realdata.sql"
	fi
elif [ "$command" = "ci" ]; then
	cd $APPDIR/spec/assist
	zenra init_db
	./insert_test_records
	cd $APPDIR
	bundle exec rspec
	cp -r coverage app/public/
	rm -rf coverage
else
	echo "Not found such command"
fi

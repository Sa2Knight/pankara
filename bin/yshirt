#!/bin/bash

PROGNAME=$(basename $0)

# ヘルプ
usage() {
  echo "ワイシャツサーバにアクセスして各種操作を行う"
  echo "  Usage: zenra $PROGNAME [-u] [-s] [-e]"
  echo "オプション"
  echo "  -u ワイシャツサーバのプログラムを更新して再起動"
  echo "  -s ワイシャツサーバを起動 or 再起動"
  echo "  -e ワイシャツサーバを停止"
  exit 1
}

# オプション解析
FLAG_S=0
FLAG_E=0
FLAG_U=0
while getopts uhes OPT
do
  case $OPT in
    h)  usage
        exit 1
        ;;
    s)  FLAG_S=1
        ;;
    e)  FLAG_E=1
        ;;
    u)  FLAG_U=1
        ;;
  esac
done
shift $((OPTIND - 1))

# メイン処理
cd $MARCHDIR
ssh="ssh root@160.16.227.161"

if [ $FLAG_S -eq 1 ]; then
  $ssh "export ZENRA=/home/zenra/March/; nohup zenra run -p 80 -r yshirt -v"
elif [ $FLAG_E -eq 1 ]; then
  $ssh "zenra stop -v"
elif [ $FLAG_U -eq 1 ]; then
  $ssh "export ZENRA=/home/zenra/March/; nohup zenra update -p 80 -r yshirt -v"
fi

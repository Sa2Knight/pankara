<h2>
  <%= h @artist['name'] %>
</h2>

<p id="wiki" class="hidden">
  <span id="summary"></span>
  <a id="wikiurl">(Wikipedia引用)</a>
</p>

<% if @artist['songs'].count > 0 %>
<h4>この歌手の楽曲一覧</h4>
<table id="artistdetail_table" class="table sortable table-striped">
  <thead>
    <tr>
      <th class='center' width='160'>動画</th>
      <th class='center'>曲名</th>
      <% if @current_user %><th class='center'>あなたが歌った回数</th><% end %>
      <th class='center'>みんなが歌った回数</th>
    </tr>
  </thead>
  <tbody>
    <% @artist['songs'].each_with_index do |song , idx| %>
    <tr>
      <td id="thumbnail_<%= idx %>" class='center' width='160'>
        <% if song['song_url'] %>
          <script>
            zenra.createThumbnail(
              "<%= idx %>" ,
              "<%= song['song_id'] %>" ,
              "<%= h song['song_name'] %>" ,
              "<%= h @artist['song_name'] %>" ,
              "<%= youtube_image song['song_url'] %>"
            );
          </script>
        <% else %>
          未登録
        <% end %>
      </td>
      <td class='center'><%= song_link song['song_id'], song['song_name'] %></td>
      <% if @current_user %><td class='center'><%= song['sang_count_as_user'] %></td><% end %>
      <td class='center'><%= song['sang_count'] %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<div id="sang_count_chart" class="hidden"></div>
<div id="artist_songs_chart" class="hidden"></div>
<div id="songs_chart_json" class="hidden"><%= @songs_chart_json %></div>

<% else %>
<h4>このアーティストには楽曲が登録されていません</h4>
<% end %>

<script>
$(function(){

  // 楽曲ごとの歌唱回数円グラフを描画
  var json = $('#songs_chart_json').text();
  var data = zenra.parseJSON(json);
  zenra.createPieChart('#artist_songs_chart' , data);

  // 月ごとの歌唱回数の棒グラフを描画
  zenra.createMonthlySangCountBarChart('/ajax/artist/tally/monthly/count' , <%= @artist['id'] %> , "#sang_count_chart");

  // Wikipediaの概要を非同期で取得
  zenra.post('/ajax/artist/wiki' , {'artist': "<%= @artist['name'] %>"} , {
    success: function(json) {
      var response = zenra.parseJSON(json);
      if (response.result == 'success') {
        var summary = response.info.summary;
        var url = response.info.url;
        $('#summary').text(summary);
        $('#wikiurl').attr('href' , url);
        $('#wiki').hide().removeClass('hidden').show('slow');
      }
    }
  });
});
</script>
